generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

enum Creator {
  COMPANY
  GUEST
}

enum Privilege {
  RO
  RW
  RWC
}

model Company {
  id        Int    @id @default(autoincrement())
  firstname String
  lastname  String
  phone     String
  email     String @unique
  
  company   String
  country   String
  city      String

  password String
 
  createdAt DateTime     @default(now())
  updatedAt DateTime     @updatedAt
  projects  Project[]
  comments  Comment[]
  guests    Invitation[]
}

model Guest {
  id        Int      @id @default(autoincrement())
  firstname String
  lastname  String
  email     String   @unique
  phone     String
  password  String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  comments Comment[]
  company  Invitation[]
}

model Invitation {
  guest          Guest     @relation(fields: [guestId], references: [id])
  guestId        Int
  company        Company   @relation(fields: [companyId], references: [id])
  companyId      Int
  privilege      Privilege
  authProjects   Json
  createdAt      DateTime  @default(now())
  expirationDate DateTime
  allProjects    Boolean

  @@id([guestId, companyId])
}

model Project {
  id          Int      @id @default(autoincrement())
  name        String
  description String
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  accountId Int // Define a foreign key referencing Company
  account   Company @relation(fields: [accountId], references: [id])

  creatorId Int // Nouvelle colonne pour stocker l'ID du créateur
  creator   Creator // Enumération pour indiquer le créateur (COMPANY ou GUEST

  resources Resource[]
  Damages   DamageImage[]
}

model Resource {
  id        Int      @id @default(autoincrement())
  type      String
  path      String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  projectId Int
  project   Project @relation(fields: [projectId], references: [id])
}

model Comment {
  id            Int          @id @default(autoincrement())
  description   String
  createdAt     DateTime     @default(now())
  updatedAt     DateTime     @updatedAt
  DamageImageId Int?
  DamageImage   DamageImage? @relation(fields: [DamageImageId], references: [id])
  CompanyId     Int?
  Company       Company?     @relation(fields: [CompanyId], references: [id])
  GuestId       Int?
  Guest         Guest?       @relation(fields: [GuestId], references: [id])
}

model DamageImage {
  id                      Int       @id @default(autoincrement())
  type                    String
  dangerDegree            Int?
  description             String?
  position                String?
  videoFrameNumber        Int
  damageImagename         String?
  damageImageCroppedname  String?
  imagesPath              String?
  modelPrediction         Int?
  DomageIdModel           Int?
  DamageClassIdModel      Int?
  detectionTimestampVideo DateTime?
  ProjectId               Int
  Comments                Comment[]
  Project                 Project   @relation(fields: [ProjectId], references: [id])
}
